<template>
    <div class="clearfix">

      <div class="w1200">
        <div class="mt10 fs14">
          <a>巨正源首页</a>><span>限时竞拍</span>
        </div>

        <div class="whitebg mt15 ovh dflex" >
          <div>
            <div class="Bidders_record">
              <ul class="Bidders_record_tab">
                <li class="curr">竞拍记录</li>
                <li >我的出价</li>
              </ul>
              <ul class="news_items">
                <!--竞拍记录-->
                <li>
                  <table class="Bidders_record_title">
                    <tbody>
                    <tr>
                      <th>当前状态</th>
                      <th>竞拍人</th>
                      <th>出价金额</th>
                      <th>数量（吨）</th>
                      <th>出价时间</th>
                    </tr>
                    </tbody>
                  </table>
                  <!--表格-->
                  <div  class="Bidders_record_list">
                    <!--暂无记录-->
                    <span class="Bidders_record_zwjl" style="display: none;">暂无记录</span>
                    <table>
                      <tbody>
                      <tr class="Bidders_record_tr orangeFont">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      <tr class="Bidders_record_tr">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      <tr class="Bidders_record_tr">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      <tr class="Bidders_record_tr">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      <tr class="Bidders_record_tr">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      <tr class="Bidders_record_tr">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      <tr class="Bidders_record_tr">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      <tr class="Bidders_record_tr">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      </tbody>
                    </table>
                  </div>
                </li>
                <!--我的出价-->
                <li style="display: none;">
                  <table class="Bidders_record_title">
                    <tbody>
                    <tr>
                      <th>当前状态</th>
                      <th>竞拍人</th>
                      <th>出价金额</th>
                      <th>数量（吨）</th>
                      <th>出价时间</th>
                    </tr>
                    </tbody>
                  </table>
                  <!--表格-->
                  <div  class="Bidders_record_list">
                    <!--暂无记录-->
                    <span class="Bidders_record_zwjl" >暂无记录</span>
                    <table style="display: none;">
                      <tbody>
                      <tr class="Bidders_record_tr orange">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      <tr class="Bidders_record_tr">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      <tr class="Bidders_record_tr">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      <tr class="Bidders_record_tr">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      <tr class="Bidders_record_tr">
                        <td><span class="Bidders_record_curr">中标</span></td>
                        <td><span>陈**</span></td>
                        <td><span>10600.00</span></td>
                        <td><span>60T</span></td>
                        <td><span>12:22:26</span></td>
                      </tr>
                      </tbody>
                    </table>
                  </div>
                </li>
              </ul>

            </div>
            <!--起拍单价价-->
            <div class="Bidders_record_detail">
              <ul class="Bidders_record_con">
                <li><span class="orangeFont">竞拍编号：</span><span>JZY15240<!--{{detailDatabrid.billNo}}--></span></li>
                <li><span class="orangeFont">品种：</span><span>PP</span></li>
                <li><span class="orangeFont">牌号：</span><span>M05HFP</span></li>
                <li><span class="orangeFont">竞拍数量：</span><span>{{detailDatabrid.totalNum}}{{detailDatabrid.uomName}}</span></li>
                <li><span class="orangeFont">厂商：</span><span>{{detailDatabrid.manufacturer}}</span></li>
                <li><span class="orangeFont">仓库：</span><span>{{detailDatabrid.warehouseName}}</span></li>
              </ul>
            </div>
          </div>
          <!--内容-->

          <div class="Bidders_record_result">
            <h1><span class="fwb">{{detailDatabrid.manufacturer}}</span> {{detailDatabrid.warehouseName}} {{detailDatabrid.skuName}} {{detailDatabrid.totalNum}}{{detailDatabrid.uom_name}}</h1>
            <div class="Bidders_record_Time">
              <div class="Bidders_record_result_over " :class="{Bidders_record_result_overbluebg:detailDatabrid.type===1,Bidders_record_result_overorangebg:detailDatabrid.type===2}">
               <span v-if="detailDatabrid.type === 1">即将开始</span>
                <span v-if="detailDatabrid.type === 2">正在竞拍</span>
              </div>
              <span class="ml10">
                 <span v-if="detailDatabrid.type === 1">距离开始</span>
                <span v-if="detailDatabrid.type === 2">距离结束</span>

              </span>
              <span class="fs16 ml15">{{`${day}天 ${hr}小时 ${min}分钟 ${sec}秒`}}</span>

         <!-- <span class="fs16 ml15"><span class="day_show1 fs22">0</span>天<span class="fs22"><font class="hour_show1 orangeFont "><s id="h"></s>02</font></span>小时<span class="fs22"><font class="minute_show1 orangeFont"><s></s>10</font></span>分钟<span class="fs22"><font class="second_show1 orangeFont"><s></s>11</font></span>秒</span>-->
            </div>
            <div class="Bidders_record_result_list graybg  mt25">
              <div class="fontScale fontScalebg">
                <span>东莞</span>
              </div>
              <div class="ml30 mt40 dflex" style="align-items: center" >
                <template v-if="bidPrice">
                  <span class="inputTitle">起拍价</span><span class="fs18 fwb orangeFont">￥{{bidPrice}} </span>元/吨
                </template>
                <template v-else>
                  <span class="inputTitle">起拍价</span><span class="fs18 fwb orangeFont">￥{{MinPrice}} </span>元/吨
                </template>


              </div>
              <!--竞拍出价-->
              <div class="ml30 dflex mt30" style="align-items: center;">
                <span class="inputTitle">竞拍出价</span>
                <span class="bodeRed cp" @click="cutsOffer()">-</span>
                <input type="text" v-model="auctionOffer" class="textInput" style="" />
                <span class="bodeRed orangeFont fwb whitebg cp" @click="addOffer()">+</span>
                <span class="ml10 gray fs14">加价幅度：{{detailDatabrid.bidIncrement}} {{detailDatabrid.base_price}}/{{detailDatabrid.uomName}}</span>
              </div>
              <!--竞拍数量-->
              <div class="ml30 dflex mt10" style="align-items: center;">
                <span class="inputTitle">竞拍数量</span>
                <span class="bodeRed">-</span>
                <input type="text" v-model="auctionNum" class="textInput" style="" />
                <span class="bodeRed orangeFont fwb whitebg">+</span>
                <span class="ml10 gray fs14">10吨起</span>
              </div>
              <!--保证金比例-->
              <div class="ml30 dflex mt20" style="align-items: center;">
                <span class="inputTitle">保证金比例</span>
                <span class="">{{detailDatabrid.marginRatio}}% </span>
              </div>
              <!--竞拍必看-->
              <div class="MustSee">竞拍必看</div>
              <div class="acuBtn" v-if="detailDatabrid.type === 2">
                <a class="oncebg" @click="StartOrder()">立即出价</a>
                <a class="Paybg ml15" @click="PayCost">追加保证金</a>
              </div>
              <div class="acuBtn" v-if="detailDatabrid.type === 1">
                <a class="startbg" @click="StartOrder()">即将开始</a>
                <a class="Paybg ml15" @click="PayCost">缴纳保证金</a>
              </div>

            </div>
          </div>



        </div>


        <div class="whitebg mt30 ovh">
          <!--正在参与-->
          <div class="mt25 ml25 mb20">
            <h1 class="paipinacu fs20">正在参与</h1>
            <table class="paipin_table">
              <tbody><tr><th>品种</th><th>牌号</th><th>厂商</th><th>竞拍总量</th><th>市场价</th><th>交易地点</th><th>交货时间</th> </tr>
              <tr><td>SG5</td><td>PVC</td><td>宁夏英特力</td><td>120.00T</td><td>￥10400.00/吨</td><td>自提</td><td>常州市</td> </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!--拍品信息-->
        <div class="whitebg mt30 ovh">


          <!--拍品信息-->
          <div class="mt25 ml25">
            <h1 class="paipinacu fs20">拍品信息</h1>
            <table class="paipin_table">
              <tbody><tr><th>品种</th><th>牌号</th><th>厂商</th><th>竞拍总量</th><th>市场价</th><th>交易地点</th><th>交货时间</th> </tr>
              <tr><td>SG5</td><td>PVC</td><td>宁夏英特力</td><td>120.00T</td><td>￥10400.00/吨</td><td>自提</td><td>常州市</td> </tr>
              </tbody>
            </table>
          </div>

          <!--竞拍流程-->
          <div class="ml25 mt30">
            <h1 class="paipinacu fs20">竞拍流程</h1>
            <img src="../../assets/img/flow.png"  class="mt20 ml30"/>
          </div>
          <!--交易信息-->
          <div class="ml25 mt30">
            <h1 class="paipinacu fs20">交易信息</h1>
            <table class="paipin_table">
              <tbody>
              <tr><th>交货方式</th><th>交货地</th><th>详细地址</th><th>交货时间</th></tr>
              <tr><td>仓库</td><td>东莞市</td><td>东莞市XXXX区</td><td>2019-06-15</td></tr>
              </tbody>
            </table>
          </div>
          <!--竞拍规则-->
          <div class="ml25 mt30">
            <h1 class="paipinacu fs20">竞拍规则</h1>
            <table class="paipin_table">
              <tbody>
              <tr><th>竞拍方式</th><th>竞拍开始时间</th><th>竞拍结束时间</th><th>允许延时</th><th>延时规则</th><th>延时时长</th><th>成交价格判定</th></tr>
              <tr><td>公开竞拍</td><td>2019-04-03 11:00:00</td><td>2019-04-03 11:00:00</td><td>是</td>
                <td style="line-height: 20px;padding: 10px;">在拍卖结束时间前2分钟内如有竞买人出价，最后结束时间延长2分钟；延长时间内再有人出价，则继续延长2分钟，直到没人出价为止，竞拍结束。</td>
                <td>2分钟</td><td>按自报价</td>
              </tr>
              </tbody>
            </table>
          </div>
          <!--备注信息-->
          <div class="ml25 mt30">
            <h1 class="paipinacu fs20">备注信息</h1>
            <p class="mt10 fs14" style="color: #666; width: 97%;">不可抗力是一项免责条款，是指买卖合同签订后，不是由于合同当事人的过失或疏忽， 而是由于发生了合同当事人无法预见、无法预防、无法避免和无法控制的事件，以致不能履行或不能
              如期履行合同， 发生意外事件的一方可以免除履行合同的责任或者推迟履行合同，在我国《民法通则》上是指“不能预见、 不能避免和不能克服的客观情况”。</p>
          </div>
          <!--真货保障-->
          <div class="ml25 mt30">
            <h1 class="paipinacu fs20">真货保障</h1>
            <p class="mt10" style="color: #666; width: 97%;">巨正源自上线以来，一直努力为会员提供优质的塑料在线交易服务。 为了更好的服务巨正源会员，推出了竞拍活动，巨正源竞拍活动的货品来自全国生产商和大贸易商， 质量值得信赖，
              目前我们正与其他供应商洽谈合作，加大货物品类及范围。</p>
            <img src="../../assets/img/serve.png"  class="mt30"/>
          </div>
          <!--合同模板-->
          <div class="ml25 mt30">
            <h1 class="paipinacu fs20">合同模板</h1>
            <div class="dflex ml10 mt10">
              <span class="contract">提</span><a>自提合同模板</a>
              <span class="contract ml15">送</span><a>配送合同模板</a>
            </div>
          </div>
          <!--联系方式-->
          <div class="ml25 mt30 mb40">
            <h1 class="paipinacu fs20">联系方式</h1>
            <table class="paipin_table"  >
              <tbody>
              <tr><th>工作时间</th><th>QQ咨询</th><th>客服热线</th></tr>
              <tr><td>
                <div style="display: flex;justify-content: center; margin: 10px auto;">
                  <div class="contactTime contactTable1"></div>工作日（9:00-18:00）
                </div>

              </td>
                <td>
                  <div style="display: flex;justify-content: center; margin: 10px auto;">
                    <div class="contactTime contactTable2"></div>3225462455
                  </div>
                </td>
                <td>
                  <div style="display: flex;justify-content: center; margin: 10px auto;">
                    <div class="contactTime contactTable3"></div>4009-000-000
                  </div>

                </td>
              </tr>
              </tbody>
            </table>
          </div>

        </div>




      </div>
      //缴纳保证金
    <PayDeposit v-show="DepositShow"   :DepositData="DepositData"></PayDeposit>

    </div>
</template>

<script>
  import PayDeposit from './BidersComponent/PayDeposit'
  import { auctionInfor, priceListInfo, NewPrice } from '../../api/users'
    export default {
      name: "BidersBegin",
      components:{
        PayDeposit
      },
      data(){
          return{
            auctionOffer:'',  //竞拍出价
            auctionNum:'',  //竞拍数量
            DepositData:[],
            DepositShow:false,
            id:'',
            detailDatabrid:'',
            countTime:'',    //倒计时
            MinPrice:'',     //最小起拍价
            bidPrice:'',     //当前价
            day: 0, hr: 0, min: 0, sec: 0
          }
      },
      methods:{
        cutsOffer(){
          console.log('bidIncrement',this.detailDatabrid.bidIncrement)
          if(this.auctionOffer>0){
            this.auctionOffer=Number(this.auctionOffer)-Number(this.detailDatabrid.bidIncrement)
          }

          console.log('auctionOffer',this.auctionOffer)
        },
        addOffer(){
          console.log('bidIncrement',this.detailDatabrid.bidIncrement)
          this.auctionOffer=Number(this.auctionOffer)+Number(this.detailDatabrid.bidIncrement)
          console.log('auctionOffer',this.auctionOffer)

        },

        PayCost(){
          this.PayCost=true
          this.DepositData.MinPrice= this.MinPrice
          this.DepositData.MinPrice= this.MinPrice
        },


        async AuctionDetail(id){
          let params={
            id:id
          }
        let res =await auctionInfor(this,params)
          console.log('res', res)
          this.detailDatabrid=res.data
          if(this.detailDatabrid.type===2){    //正在竞拍
            this.countTime = Date.parse(new Date(this.detailDatabrid.reservationEndTime))
          }
          if(this.detailDatabrid.type===1){    //即将开始
            this.countTime = Date.parse(new Date(this.detailDatabrid.beginTime))
          }
          this.countdown()
          this.priceInfo(this.detailDatabrid.skuId)
          this.NewPrice(this.detailDatabrid.id)
        },

        //最小起拍价
        async priceInfo(id){
          let params={
            skuId:id
          }
          let res =await priceListInfo(this,params)
          console.log('最小起拍价res',res)
          this.MinPrice=res.data.minSellingPrice
        },

        StartOrder(){
          this.$router.push({path:'./BidersSubmit'})
        },
        PayCost(){
          this.$router.push({path:'./BidersPayCost'})
        },
        //获取最新的竞拍价
        async NewPrice(id){
          let params={
            auctionId:id
          }
          let res=await NewPrice(this,params)
          console.log('获取最新的竞拍价',res)
          this.bidPrice=res.data.bidPrice
        },
        //倒计时
       countdown() {
         const end=Date.parse(new Date(this.countTime))
         const now = Date.parse(new Date())
         if(end>now){
           const msec = end - now
          let day = parseInt(msec / 1000 / 60 / 60 / 24)
          let hr = parseInt(msec / 1000 / 60 / 60 % 24)
          let min = parseInt(msec / 1000 / 60 % 60)
          let sec = parseInt(msec / 1000 % 60)
          this.day = day
          this.hr = hr > 9 ? hr : '0' + hr
          this.min = min > 9 ? min : '0' + min
          this.sec = sec > 9 ? sec : '0' + sec
          const that = this
          setTimeout(function () {
            that.countdown()
          }, 1000)
         }
       }
      },
      mounted() {
        console.log('this.$router',this.$router)
        this.id=this.$router.history.current.query.id
        this.AuctionDetail(this.id)


      }
    }
</script>

<style scoped>

  .Bidders_record{margin-top: 30px; margin-left: 20px;  width: 575px;  border: 1px solid #DEDEDE;}
  .Bidders_record .Bidders_record_title { line-height: 50px;}
  .Bidders_record_title th {width: 144px;text-align: center; font-size: 14px}
  .Bidders_record_tab{ display: flex; border-bottom: 1px solid #DDDDDD;}
  .Bidders_record_tab li{width: 50%; text-align: center; padding: 15px 0; font-size: 14px;}
  .Bidders_record_tab li.curr{background-color: #ff7300; color: #fff;  }
  .Bidders_record .Bidders_record_list {overflow-y: auto; height: 285px;   border: 2px solid #ff7701;  box-sizing: border-box;}
  .Bidders_record_list table {width: 100%;}
  .Bidders_record_list tr {height: 40px;}
  .Bidders_record_list tr td {width: 114px;text-align: center; font-size: 14px;}
  .Bidders_record_list tr:nth-child(odd) {background: #f7f7f7;}
  .Bidders_record span {display: inline-block;}
  .Bidders_record_curr {padding:1px 10px;  text-align: center; background: #fe7601;color: #fff; border-radius: 15px;}

  /*起拍单价*/
  .Bidders_record_detail { overflow: hidden;   margin-top: 20px; margin-left: 20px; margin-bottom: 30px; width: 575px;   margin-top: 15px;}
  .Bidders_record_table{width: 100%; }
  .Bidders_record_table tr td{border: 1px solid #DEDEDE; font-size: 12px; line-height: 30px; padding-left: 10px; box-sizing: border-box;}
  .Bidders_record_table .Bidderstitle{  background: #f5f5f5; width: 20%;    font-size: 14px;}
  .Bidders_record_con{display: flex;flex-wrap: wrap; background: #f5f5f5;    padding: 10px 20px;}
  .Bidders_record_con li{width: 33%;   font-size: 14px;     line-height: 25px;  overflow: hidden;
    -ms-text-overflow: ellipsis; white-space:nowrap;
    text-overflow: ellipsis;}
  .news_items{height: 335px;overflow: hidden;}
  /*内容*/
  .Bidders_record_result{overflow: hidden;margin-left: 30px; margin-top: 25px;}
  .Bidders_record_result h1{font-size: 20px;}
  .Bidders_record_result_overbluebg { background: url(../../assets/img/Bidders_icon02.png)no-repeat center;}
  .Bidders_record_result_overorangebg{background: url(../../assets/img/Bidders_icon03.png)no-repeat center;}
  .Bidders_record_result_over {  width: 70px; line-height: 25px; text-align: center; color: #fff; font-size: 12px;}
  .Bidders_record_Time{display: flex;align-items: center;margin-top: 15px;}
  .Bidders_record_result_list{width: 546px;position: relative; overflow: hidden;}
  .fontScalebg{border-color:transparent transparent transparent #a3cf3c;}
  .fontScaleTipbg{border-color:transparent transparent transparent #dddddd;}

  .fontScale{font-size: 16px;color: #fff; font-weight: bold;width:0;height:0; border-width:0 0 55px 55px;
    border-style:solid; position:absolute; top: 0;left: 0; display: flex;}
  .fontScale>span{transform: rotate(-45deg);
    -moz-transform: rotate(-45deg);/* Firefox 旋转属性，参数表示角度(deg表示角度)，负数逆时针，正数顺时针 */
    -webkit-transform: rotate(-45deg);/* Safari和Chrome */
    -ms-transform: rotate(-45deg);/* IE 9 */
    -o-transform: rotate(-45deg);/* Opera */
    margin-left: -60px; margin-top: 10px;}
  .inputTitle{width: 80px;display: flex; align-items: center; margin-right:20px; font-size: 14px;}
  .bodeRed{font-size:16px;box-sizing: border-box;width: 28px;height: 40px; border: 1px solid #dddddd; display: flex;align-items: center;justify-content: center;}
  .textInput{height: 40px; box-sizing: border-box; border:none;border-bottom: 1px solid #DDDDDD;border-top: 1px solid #DDDDDD;text-align: center; background-color: #fff;}
  .MustSee{ background: url(../../assets/img/icon.png)no-repeat -65px -1px; width: 150px; margin-left: 130px;margin-top: 10px; padding-left: 25px;position: relative;}
  .acuBtn{ margin-top: 30px; margin-bottom: 58px; margin-left: 130px;display:flex;}
  .acuBtn a{ border-radius: 3px; color: #fff; width: 165px;height: 40px;text-align: center; line-height: 40px; font-size: 18px;}
  .acuBtn .startbg{background-color: #23aa36;}
  .acuBtn .oncebg{background-color: #ff7300;}
  .acuBtn .Paybg{background-color: #007de4;}
  .HandIn{background-color: #007de4; color: #fff; padding: 3px 15px; border-radius:3px ;}

  /*首页-竞拍时间*/
  .paipinacu{color: #333;}
  .AuctionTime ul{display: flex;}
  .AuctionTime li{background-color: #fff;width: 33.3%; text-align: center;padding: 10px 0;}
  .AuctionTime li.curr{color: #fff;background-color: #ff6c00; box-shadow: 6px 0px 3px 1px #ff6c00;z-index: 10;position: relative;}
  .AtP{margin-top: 3px;display: flex; justify-content: center; align-items: center;}
  .Atborder{ text-align: center; padding: 0px 10px;  border-radius: 15px; border: 1px solid #CCCCCC;  color: #CCCCCC; font-size: 14px; overflow: hidden;}


  .paipin_table {width: 97%;  margin-top: 10px;  border-left: 1px solid #D5D5D5;  border-top: 1px solid #D5D5D5;}
  .paipin_table tr { line-height: 40px; font-size: 14px;}
  .paipin_table tr th { color: #999999;  background: #f5f5f5;  width: 137px;  border-right: 1px solid #D5D5D5;  border-bottom: 1px solid #D5D5D5;}
  .paipin_table tr td { color: #666; text-align: center;  border-right: 1px solid #D5D5D5;  border-bottom: 1px solid #D5D5D5;}

  /*合同模板*/
  .dflex>a{ text-decoration:underline;  }
  .dflex .contract{background-color: #ff7300; color: #fff; padding: 0 3px;border-radius: 3px; box-sizing: border-box; margin-right: 5px;}

</style>
